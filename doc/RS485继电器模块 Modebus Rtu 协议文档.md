概述

本设备通过 RS-485 半双工总线、采用 Modbus RTU 协议通信。支持读/写线圈与保持寄存器，提供：通道工作模式、批量开关、定时/脉冲（自动复位/循环）等功能。

接线与拓扑

A → 上位机/网关 A(DI+)；B → 上位机/网关 B(DI−)

设备偏多时，总线末端建议加 120 Ω 终端电阻

多机并联尽量 总线型拓扑，避免星型

屏蔽层 单端接地；通信线建议 双绞线

通讯参数

波特率：默认 38400（可设，见寄存器 0043H）
示例支持：4800/9600/14400/19200/38400/56000/57600/115200

数据位：8

校验位：可设（见 0044H）：0=None，1=Odd，2=Even

停止位：无校验通常 2，奇/偶校验通常 1（以主站配置为准）

从站地址范围：1–255（见 0042H）

帧格式与时序

帧格式：地址(1B) + 功能码(1B) + 数据(NB) + CRC16(低字节在前, 高字节在后)

帧间隔：≥ 3.5 字符时间（RTU 规范）

CRC：多项式 0xA001，初值 0xFFFF

参考实现（C）：

uint16_t factory_crc16(uint8_t* bufData, uint16_t buflen){
    uint16_t TCPCRC=0xFFFF, POLY=0xA001; uint8_t i,j;
    for(i=0;i<buflen;i++){ TCPCRC^=bufData[i];
        for(j=0;j<8;j++){ if(TCPCRC&1){ TCPCRC>>=1; TCPCRC^=POLY; } else { TCPCRC>>=1; } } }
    return TCPCRC;
}


寄存器数据字节序：按 Modbus 规范，高字节在前（示例帧可见）

功能码支持
功能码	功能	地址范围	操作类型	数量
01	读线圈状态	0000H–0040H	位	单/多
03	读保持寄存器	0000H–008FH	字	单/多
05	写单个线圈	0000H–0040H	位	单
06	写单个保持寄存器	0000H–008FH	字	单
0F	写多个线圈	0000H–0040H	位	多
10	写多个保持寄存器	0000H–008FH	字	多
地址映射

说明：以下为主要地址段与含义；具体实现以当前固件为准。

线圈（Coils，功能码 01/05/0F）

范围：0000H–0040H（示例）

0000H…0007H 对应 继电器通道 1…8；更高通道顺延

批量位写时：最低位对应起始地址

保持寄存器（Holding Registers，功能码 03/06/10）
地址(HEX)	名称/作用	取值/说明
0000H	通道1 控制寄存器（工作模式与动作）	work_mode_normal 普通 1/0=开/关；work_mode_flip 点动/翻转（写1翻转）；work_mode_delay 延时 N×0.01s 后动作；work_mode_loop 开关循环（周期由保持时间决定，参考 0040H/0041H）；work_mode_auto_reset 自动复位 N×0.01s 后自动关闭。实际枚举以 0050H 起各通道模式寄存器为准
003FH	通道64 控制寄存器	同上（通道索引递增）
0040H	通信检测时间	N×0.1s；0=不检测；>1 当通信断开 N×0.1s 后断开所有输出；掉电保持，上电生效
0041H	输入口上报/动作次数	0 不主动上报；1 状态变化即上报；>1 累计 (N-1)×0.01s 后上报/动作；掉电保持，上电生效
0042H	从站地址	1–255；掉电保持，重启生效
0043H	RS-485 波特率	0:4800, 1:9600, 2:14400, 3:19200, 4:38400, 5:56000, 6:57600, 7:115200；掉电保持，重启生效
0044H	奇偶校验	0:无，1:奇，2:偶；掉电保持，重启生效
0045H	继电器批量控制	1=全开；0=全关
0046H	按位控制通道 1–16	位=1 导通；位=0 关闭
0047H	按位控制通道 17–32	位=1 导通；位=0 关闭
0048H	按位控制通道 33–48	位=1 导通；位=0 关闭
0049H	按位控制通道 49–64	位=1 导通；位=0 关闭
004AH	软复位	写 1 执行复位；设备自复位后本位自动归 0
004BH–004FH	保留	—
0050H	通道1 工作模式	0 普通；1 点动；2 定时；3 开关循环；4 自动复位
…	…	…
008FH	通道64 工作模式	同上
通讯示例帧（十六进制）

01：读线圈状态（主机→从机）：读起始地址 000AH，数量 000AH
01 01 00 0A 00 0A 9C 0F

01：读线圈状态（从机→主机）：返回 2 字节位图（示例）
01 01 02 F0 03 BD FD

03：读保持寄存器（主机→从机）：自 0002H 起读 2 个
01 03 00 02 00 02 C4 0B

03：读保持寄存器（从机→主机）：回 4 字节数据（示例值）
01 03 04 F0 C3 A0 4F 00 FB

05：写单个线圈（主机→从机 / 回显）：将线圈 000AH 置位（FF00=ON）
01 05 00 0A FF 00 AC 38
01 05 00 0A FF 00 AC 38

06：写单个保持寄存器（主机→从机 / 回显）：写 0013H=0x15C2
01 06 00 13 15 C2 F7 0E
01 06 00 13 15 C2 F7 0E

0F：写多个线圈（主机→从机 / 从机→主机）：自 000AH 写 10 个线圈，共 2 字节
01 0F 00 0A 00 0A 02 AA 0A 1A F3
01 0F 00 0A 00 0A 1A F3

10：写多个保持寄存器（主机→从机 / 从机→主机）：自 0013H 写 2 个寄存器（示例值 0x1253, 0x3C1F）
01 10 00 13 00 02 04 12 53 3C 1F 17 17
01 10 00 13 00 02 B0 0D

快速操作·常用场景

批量按位控制

0046H–0049H：分别控制 1–16 / 17–32 / 33–48 / 49–64（位=1 导通）

0045H：全开/全关（1=全开, 0=全关）

通道工作模式设定（0050H…008FH 每通道 1 字）
0 普通 / 1 点动(翻转) / 2 定时（结合 0040H/0041H）/ 3 循环 / 4 自动复位

设备管理

0042H 从站地址、0043H 波特率、0044H 校验位：掉电保持、重启生效

004AH 写 1 触发 软件复位

常见问题排查

无响应

核对从站地址、波特率、校验位是否与主站一致

检查 A/B 是否接反、末端是否加 120 Ω

适当增大主站 超时与重试

CRC 错误

确认 CRC 低字节在前；帧内 无空格/分隔符

先 降低波特率，检查屏蔽与接地

偶发丢帧

延长 帧间隔、优化 收发方向切换 时序

排查 供电稳定性与共地

备注：你文中提到“在线 CRC 计算（23bei 工具）”，可用于交叉校验帧与 CRC。

如果你需要，我可以基于这份速查手册，再补一页 主站示例（如 Python/PLC/STC/ESP32） 的读写代码片段与测试脚本，或按你的寄存器映射生成一份 测试用例表（含期望帧与 CRC）